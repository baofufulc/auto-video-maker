<!DOCTYPE html>
<html lang="zh-CN">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>AIæƒ…æ„ŸçŸ­è§†é¢‘ç”Ÿæˆå™¨ v8.0</title>
<style>
body {
  margin: 0; background: #000; color: white; font-family: "Microsoft YaHei";
  display: flex; flex-direction: column; align-items: center; justify-content: flex-start;
  height: 100vh; overflow: hidden;
}
h2 { margin: 10px; font-size: 20px; }
textarea {
  width: 90%; height: 100px; font-size: 16px; border-radius: 10px;
  padding: 8px; border: none; outline: none;
}
button {
  margin: 8px; padding: 10px 20px; font-size: 16px; border-radius: 8px;
  border: none; cursor: pointer; color: white;
  background: linear-gradient(45deg, #ff3366, #ff6600);
}
.video-box {
  position: relative; width: 360px; height: 640px; overflow: hidden;
  border-radius: 15px; box-shadow: 0 0 20px #ff0066;
}
video {
  width: 100%; height: 100%; object-fit: cover;
  filter: brightness(0.7);
}
.subtitle {
  position: absolute; bottom: 80px; width: 100%; text-align: center;
  font-size: 22px; font-weight: bold; color: #fff;
  text-shadow: 0 0 12px #ff0066, 0 0 25px #ff66cc;
  animation: glow 2s ease-in-out infinite alternate;
}
@keyframes glow { 0% {opacity: 0.6;} 100% {opacity: 1;} }
</style>
</head>
<body>
  <h2>ğŸ¬ AIæƒ…æ„ŸçŸ­è§†é¢‘ç”Ÿæˆå™¨ v8.0</h2>
  <textarea id="textInput" placeholder="è¾“å…¥æƒ…æ„Ÿæ–‡æ¡ˆï¼Œä¾‹å¦‚ï¼šæˆ‘æ‹¼å‘½åŠªåŠ›ï¼Œæ˜¯å› ä¸ºåˆ«æ— é€‰æ‹©..."></textarea>
  <div>
    <button id="generateBtn">ç”Ÿæˆè§†é¢‘</button>
    <button id="downloadBtn">ä¸‹è½½MP4</button>
  </div>

  <div class="video-box" id="videoArea">
    <video id="bgVideo" autoplay loop muted></video>
    <div class="subtitle" id="subtitle"></div>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/recordrtc@5.6.2/RecordRTC.min.js"></script>
  <script>
  const bgVideo = document.getElementById("bgVideo");
  const subtitle = document.getElementById("subtitle");
  const generateBtn = document.getElementById("generateBtn");
  const downloadBtn = document.getElementById("downloadBtn");
  let recorder;

  const backgrounds = {
    sad: [
      "https://cdn.pixabay.com/video/2024/01/02/197045-899816385_tiny.mp4",
      "https://cdn.pixabay.com/video/2023/12/21/194434-896594650_tiny.mp4"
    ],
    lonely: [
      "https://cdn.pixabay.com/video/2023/03/09/153024-805776398_tiny.mp4",
      "https://cdn.pixabay.com/video/2023/06/17/168230-842420944_tiny.mp4"
    ],
    healing: [
      "https://cdn.pixabay.com/video/2023/09/04/178506-863291441_tiny.mp4",
      "https://cdn.pixabay.com/video/2023/06/27/169742-846511832_tiny.mp4"
    ],
    positive: [
      "https://cdn.pixabay.com/video/2023/02/16/151125-795688312_tiny.mp4",
      "https://cdn.pixabay.com/video/2023/06/14/167305-839689132_tiny.mp4"
    ]
  };

  function detectEmotion(text) {
    const map = {
      sad: ["ç´¯","å¿ƒé…¸","çœ¼æ³ª","ç–²æƒ«","å¤±è½","éš¾è¿‡"],
      lonely: ["å­¤ç‹¬","å¯‚å¯","å¤œ","å†·","ä¸€ä¸ªäºº"],
      healing: ["æ¸©æŸ”","æ²»æ„ˆ","å¹³é™","æ”¾æ¾","å®‰é™"],
      positive: ["å¥‹æ–—","åŠªåŠ›","å¸Œæœ›","æ¢¦æƒ³","é˜³å…‰"]
    };
    for (let [key, words] of Object.entries(map)) {
      if (words.some(w => text.includes(w))) return key;
    }
    return "sad";
  }

  generateBtn.onclick = async () => {
    const text = document.getElementById("textInput").value.trim();
    if (!text) return alert("è¯·è¾“å…¥æ–‡å­—");
    const emotion = detectEmotion(text);
    const bg = backgrounds[emotion][Math.floor(Math.random()*backgrounds[emotion].length)];
    bgVideo.src = bg;

    const utter = new SpeechSynthesisUtterance(text);
    utter.lang = "zh-CN";
    utter.pitch = 0.6; // ä½æ²‰
    utter.rate = 0.92; // ç¨æ…¢ï¼Œæ˜¾æƒ…æ„Ÿ
    utter.volume = 1;
    utter.onstart = () => {
      const parts = text.match(/.{1,10}/g) || [text];
      let i = 0;
      subtitle.textContent = parts[0];
      const timer = setInterval(() => {
        i++;
        if (i < parts.length) subtitle.textContent = parts[i];
        else clearInterval(timer);
      }, 2000);
    };
    speechSynthesis.cancel();
    speechSynthesis.speak(utter);
  };

  downloadBtn.onclick = async () => {
    const stream = document.getElementById("videoArea").captureStream(30);
    recorder = new RecordRTC(stream, { type: "video" });
    recorder.startRecording();
    alert("ğŸ¥ å¼€å§‹å½•åˆ¶ï¼Œçº¦5ç§’åè‡ªåŠ¨ç”Ÿæˆè§†é¢‘...");
    setTimeout(async () => {
      await recorder.stopRecording(() => {
        const blob = recorder.getBlob();
        const url = URL.createObjectURL(blob);
        const a = document.createElement("a");
        a.href = url;
        a.download = "emotion_video.mp4";
        a.click();
      });
    }, 5000);
  };
  </script>
</body>
</html>
