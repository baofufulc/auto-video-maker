<!DOCTYPE html>
<html lang="zh-CN">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>AIæƒ…æ„ŸçŸ­è§†é¢‘ç”Ÿæˆå™¨ v9.0</title>
<style>
body {
  margin: 0;
  background: #000;
  color: white;
  font-family: "Microsoft YaHei";
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: flex-start;
  min-height: 100vh;
}
h2 {
  margin: 10px;
  font-size: 20px;
}
textarea {
  width: 90%;
  height: 100px;
  font-size: 16px;
  border-radius: 10px;
  padding: 8px;
  border: none;
  outline: none;
  resize: none;
}
button {
  margin: 8px;
  padding: 10px 20px;
  font-size: 16px;
  border-radius: 8px;
  border: none;
  cursor: pointer;
  color: white;
  background: linear-gradient(45deg, #ff3366, #ff6600);
}
.video-box {
  position: relative;
  width: 360px;
  height: 640px;
  overflow: hidden;
  border-radius: 15px;
  box-shadow: 0 0 25px #ff0066;
}
video {
  width: 100%;
  height: 100%;
  object-fit: cover;
  filter: brightness(0.7);
}
.subtitle, .title, .outro {
  position: absolute;
  width: 100%;
  text-align: center;
  color: #fff;
  text-shadow: 0 0 10px #ff0099, 0 0 20px #ff99cc;
  font-weight: bold;
  opacity: 0;
  transition: opacity 1s ease;
}
.title {
  top: 30%;
  font-size: 26px;
}
.subtitle {
  bottom: 80px;
  font-size: 22px;
}
.outro {
  bottom: 40%;
  font-size: 20px;
}
</style>
</head>
<body>
  <h2>ğŸ¬ AIæƒ…æ„ŸçŸ­è§†é¢‘ç”Ÿæˆå™¨ v9.0</h2>
  <textarea id="textInput" placeholder="è¾“å…¥æƒ…æ„Ÿæ–‡æ¡ˆï¼Œä¾‹å¦‚ï¼šæˆ‘æ‹¼å‘½åŠªåŠ›ï¼Œæ˜¯å› ä¸ºåˆ«æ— é€‰æ‹©..."></textarea>
  <div>
    <button id="generateBtn">ç”Ÿæˆè§†é¢‘</button>
    <button id="downloadBtn">ä¸‹è½½MP4</button>
  </div>

  <div class="video-box" id="videoArea">
    <video id="bgVideo" autoplay loop muted></video>
    <div class="title" id="titleText"></div>
    <div class="subtitle" id="subtitle"></div>
    <div class="outro" id="outroText"></div>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/recordrtc@5.6.2/RecordRTC.min.js"></script>
  <script>
  const bgVideo = document.getElementById("bgVideo");
  const titleText = document.getElementById("titleText");
  const subtitle = document.getElementById("subtitle");
  const outroText = document.getElementById("outroText");
  const generateBtn = document.getElementById("generateBtn");
  const downloadBtn = document.getElementById("downloadBtn");
  let recorder;

  const backgrounds = [
    "https://cdn.pixabay.com/video/2023/12/21/194434-896594650_tiny.mp4",
    "https://cdn.pixabay.com/video/2023/06/27/169742-846511832_tiny.mp4",
    "https://cdn.pixabay.com/video/2023/02/16/151125-795688312_tiny.mp4",
    "https://cdn.pixabay.com/video/2024/01/02/197045-899816385_tiny.mp4"
  ];

  generateBtn.onclick = async () => {
    const text = document.getElementById("textInput").value.trim();
    if (!text) return alert("è¯·è¾“å…¥æ–‡å­—");

    bgVideo.src = backgrounds[Math.floor(Math.random()*backgrounds.length)];
    titleText.textContent = "SoulTalk Studio Â· å¿ƒå£°çŸ­ç‰‡";
    outroText.textContent = "â€”â€” ç”¨å¿ƒæ„Ÿå—æ¯ä¸€ä¸ªç¬é—´ â€”â€”";

    titleText.style.opacity = 1;
    setTimeout(()=>titleText.style.opacity=0, 3000);

    const parts = text.match(/.{1,10}/g) || [text];
    let i = 0;
    subtitle.style.opacity = 1;
    subtitle.textContent = parts[0];
    const timer = setInterval(() => {
      i++;
      if (i < parts.length) subtitle.textContent = parts[i];
      else {
        clearInterval(timer);
        subtitle.style.opacity = 0;
        outroText.style.opacity = 1;
      }
    }, 2200);

    const utter = new SpeechSynthesisUtterance(text);
    utter.lang = "zh-CN";
    utter.pitch = 0.6; // ç”·å£°ä½æ²‰
    utter.rate = 0.9;
    utter.volume = 1;
    const voices = speechSynthesis.getVoices();
    utter.voice = voices.find(v => v.name.includes("Male") || v.name.includes("ç”·")) || voices[0];
    speechSynthesis.cancel();
    speechSynthesis.speak(utter);

    const audio = new Audio("https://cdn.pixabay.com/audio/2023/10/26/audio_1f7cf6e3de.mp3");
    audio.volume = 0.4;
    audio.play();
  };

  downloadBtn.onclick = async () => {
    const stream = document.getElementById("videoArea").captureStream(30);
    recorder = new RecordRTC(stream, { type: "video" });
    recorder.startRecording();
    alert("ğŸ¥ æ­£åœ¨å½•åˆ¶è§†é¢‘ï¼Œè¯·ç¨å€™çº¦8ç§’...");
    setTimeout(async () => {
      await recorder.stopRecording(() => {
        const blob = recorder.getBlob();
        const url = URL.createObjectURL(blob);
        const a = document.createElement("a");
        a.href = url;
        a.download = "emotion_video.mp4";
        a.click();
      });
    }, 8000);
  };
  </script>
</body>
</html>
