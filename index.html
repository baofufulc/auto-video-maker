<!DOCTYPE html>
<html lang="zh-CN">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>AIæƒ…æ„ŸçŸ­è§†é¢‘ç”Ÿæˆå™¨ v7</title>
<style>
body {
  margin: 0; background: #000; color: white;
  font-family: "Microsoft YaHei", sans-serif;
  display: flex; flex-direction: column; align-items: center;
  height: 100vh; overflow: hidden;
}
h2 { margin-top: 10px; }
textarea {
  width: 90%; height: 100px; font-size: 16px;
  border-radius: 8px; padding: 8px; outline: none; border: none;
}
button {
  margin: 8px; padding: 10px 20px; font-size: 16px;
  border: none; border-radius: 8px;
  background: linear-gradient(45deg, #ff3366, #ff6600);
  color: white;
}
.video-container {
  position: relative; width: 360px; height: 640px;
  border-radius: 12px; overflow: hidden; margin-top: 10px;
}
video {
  width: 100%; height: 100%; object-fit: cover;
  filter: brightness(0.7);
}
.subtitle {
  position: absolute; bottom: 60px; width: 100%;
  text-align: center; font-size: 22px; font-weight: bold;
  color: #fff; text-shadow: 0 0 12px #ff0066, 0 0 20px #ff66cc;
  animation: glow 2s ease-in-out infinite alternate;
}
@keyframes glow { 0% {opacity: 0.6;} 100% {opacity: 1;} }
</style>
</head>
<body>
  <h2>ğŸ¬ AIæƒ…æ„ŸçŸ­è§†é¢‘ç”Ÿæˆå™¨ v7</h2>
  <textarea id="textInput" placeholder="è¾“å…¥æ–‡å­—ï¼Œä¾‹å¦‚ï¼šæˆ‘æ‹¼å‘½æŒ£é’±ï¼Œå› ä¸ºæ²¡æœ‰äººèƒ½æ›¿æˆ‘..."></textarea>
  <div>
    <button id="generateBtn">ç”Ÿæˆè§†é¢‘</button>
    <button id="downloadBtn" disabled>å¯¼å‡ºMP4</button>
  </div>

  <div class="video-container">
    <video id="preview" autoplay loop muted></video>
    <audio id="bgm" loop></audio>
    <div id="subtitle" class="subtitle"></div>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/recordrtc/RecordRTC.min.js"></script>
  <script>
  const preview = document.getElementById("preview");
  const bgm = document.getElementById("bgm");
  const subtitle = document.getElementById("subtitle");
  const generateBtn = document.getElementById("generateBtn");
  const downloadBtn = document.getElementById("downloadBtn");

  const backgrounds = {
    positive: [
      "https://cdn.pixabay.com/video/2023/06/14/167305-839689132_tiny.mp4",
      "https://cdn.pixabay.com/video/2023/02/16/151125-795688312_tiny.mp4"
    ],
    sad: [
      "https://cdn.pixabay.com/video/2024/01/02/197045-899816385_tiny.mp4",
      "https://cdn.pixabay.com/video/2023/12/21/194434-896594650_tiny.mp4"
    ],
    lonely: [
      "https://cdn.pixabay.com/video/2023/03/09/153024-805776398_tiny.mp4",
      "https://cdn.pixabay.com/video/2023/06/17/168230-842420944_tiny.mp4"
    ],
    healing: [
      "https://cdn.pixabay.com/video/2023/09/04/178506-863291441_tiny.mp4",
      "https://cdn.pixabay.com/video/2023/06/27/169742-846511832_tiny.mp4"
    ]
  };

  const musics = {
    positive: "https://cdn.pixabay.com/download/audio/2023/04/11/audio_55b63c7c68.mp3?filename=inspired-ambient-piano-145468.mp3",
    sad: "https://cdn.pixabay.com/download/audio/2023/03/15/audio_29ec0ec167.mp3?filename=sad-piano-143077.mp3",
    lonely: "https://cdn.pixabay.com/download/audio/2023/04/11/audio_8d9f6d7a7d.mp3?filename=lonesome-145487.mp3",
    healing: "https://cdn.pixabay.com/download/audio/2023/04/12/audio_9c8f0e7895.mp3?filename=soft-healing-piano-145611.mp3"
  };

  function detectEmotion(text) {
    const positiveWords = ["åŠªåŠ›","å¥‹æ–—","å¸Œæœ›","é˜³å…‰","æ¢¦æƒ³"];
    const sadWords = ["ç´¯","å¿ƒé…¸","çœ¼æ³ª","ç–²æƒ«","å¤±è½","éš¾è¿‡"];
    const lonelyWords = ["å­¤ç‹¬","å¯‚å¯","å¤œæ™š","ä¸€ä¸ªäºº"];
    const healingWords = ["æ²»æ„ˆ","æ¸©æŸ”","ç¾å¥½","å¹³é™","å®‰é™"];
    text = text.toLowerCase();
    if (sadWords.some(w => text.includes(w))) return "sad";
    if (lonelyWords.some(w => text.includes(w))) return "lonely";
    if (healingWords.some(w => text.includes(w))) return "healing";
    return "positive";
  }

  generateBtn.onclick = async () => {
    const text = document.getElementById("textInput").value.trim();
    if (!text) return alert("è¯·è¾“å…¥æ–‡å­—ï¼");

    const emotion = detectEmotion(text);
    const bgUrl = backgrounds[emotion][Math.floor(Math.random() * backgrounds[emotion].length)];
    const musicUrl = musics[emotion];

    preview.src = bgUrl;
    bgm.src = musicUrl;
    bgm.play();

    // æ˜¾ç¤ºå­—å¹•
    const parts = text.match(/.{1,10}/g) || [text];
    let i = 0;
    const showNext = () => {
      if (i < parts.length) {
        subtitle.textContent = parts[i++];
        setTimeout(showNext, 2000);
      } else subtitle.textContent = "";
    };
    showNext();

    // ä¸­æ–‡ç”·å£°æœ—è¯»
    const synth = window.speechSynthesis;
    const utter = new SpeechSynthesisUtterance(text);
    utter.lang = "zh-CN";
    utter.pitch = 0.9;
    utter.rate = 1.0;
    utter.volume = 1.0;
    synth.speak(utter);

    downloadBtn.disabled = false;
  };

  downloadBtn.onclick = async () => {
    const videoStream = preview.captureStream();
    const audioStream = bgm.captureStream();
    const mixedStream = new MediaStream([
      ...videoStream.getVideoTracks(),
      ...audioStream.getAudioTracks()
    ]);

    const recorder = RecordRTC(mixedStream, { type: 'video' });
    recorder.startRecording();

    setTimeout(async () => {
      await recorder.stopRecording();
      const blob = recorder.getBlob();
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url;
      a.download = 'AIæƒ…æ„ŸçŸ­è§†é¢‘.mp4';
      a.click();
      URL.revokeObjectURL(url);
    }, 10000);
  };
  </script>
</body>
</html>
